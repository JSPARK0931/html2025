<!DOCTYPE html>
<html lang="ko">
  <head>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.11.0/axios.min.js"
      integrity="sha512-h9644v03pHqrIHThkvXhB2PJ8zf5E9IyVnrSfZg8Yj8k4RsO4zldcQc4Bi9iVLUCCsqNY0b4WXVV4UB+wbWENA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.18/dayjs.min.js"
      integrity="sha512-FwNWaxyfy2XlEINoSnZh1JQ5TRRtGow0D6XcmAWmYCRgvqOUTnzCxPc9uF35u5ZEpirk1uhlPVA19tflhvnW1g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/locale/ko.js"></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      html,
      body {
        height: 100%;
      }
      * {
        margin: 0;
        padding: 0;
      }
      .mapLoc {
        padding: 10px;
        background: none;
        border-radius: 10px;
        box-shadow: 5px 5px 5px rgba(0, 0, 0, 0.3);
        display: flex;
        justify-content: center;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <div id="map" style="width: 100%; height: 100%"></div>
    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=37d8d4a676744518264602a09fcafa4f"
    ></script>
    <script>
      const container = document.getElementById("map");
      const mapLoc = [
        { id: "seoul", name: "서울 시청", lat: 37.5665, lon: 126.978, icon: "04d" },
        { id: "busan", name: "부산", lat: 35.1796, lon: 129.0756, icon: "04d" },
        { id: "incheon", name: "인천", lat: 37.4563, lon: 126.7052, icon: "10d" },
        { id: "daegu", name: "대구", lat: 35.8714, lon: 128.6014, icon: "10d" },
        { id: "gwangju", name: "광주", lat: 35.1595, lon: 126.8526, icon: "10d" },
        { id: "daejeon", name: "대전", lat: 36.3504, lon: 127.3845, icon: "10d" },
        { id: "ulsan", name: "울산", lat: 35.5384, lon: 129.3114, icon: "10d" },
        { id: "sejong", name: "세종", lat: 36.4801, lon: 127.289, icon: "10d" },
        { id: "suwon", name: "수원", lat: 37.2636, lon: 127.0286, icon: "10d" },
        { id: "chuncheon", name: "춘천", lat: 37.8813, lon: 127.7298, icon: "10d" },
        { id: "gangneung", name: "강릉", lat: 37.7519, lon: 128.8761, icon: "10d" },
        { id: "cheongju", name: "청주", lat: 36.6424, lon: 127.489, icon: "10d" },
        { id: "jeonju", name: "전주", lat: 35.8242, lon: 127.148, icon: "10d" },
        { id: "mokpo", name: "목포", lat: 34.8118, lon: 126.3922, icon: "10d" },
        { id: "yeosu", name: "여수", lat: 34.7604, lon: 127.6622, icon: "10d" },
        { id: "pohang", name: "포항", lat: 36.019, lon: 129.3435, icon: "10d" },
        { id: "changwon", name: "창원", lat: 35.227, lon: 128.6811, icon: "10d" },
        { id: "jeju", name: "제주", lat: 33.4996, lon: 126.5312, icon: "10d" },
      ];

      function locView(lat, lon) {
        const options = {
          center: new kakao.maps.LatLng(lat, lon),
          level: 13, //지도레벨, 작을수록 detail
        };

        const map = new kakao.maps.Map(container, options);

        for (let i = 0; i < mapLoc.length; i++) {
          const marker = new kakao.maps.Marker({
            map: map,
            position: new kakao.maps.LatLng(mapLoc[i].lat, mapLoc[i].lon),
            title: mapLoc[i].name,
          });

          // 날씨를 출력
          getWeather(lat, lon, i);
          console.log("icons====" + mapLoc[i].icon);

          // 커스텀 오버레이가 표시될 위치입니다
          const overPosition = new kakao.maps.LatLng(mapLoc[i].lat, mapLoc[i].lon);
          // 커스텀 오버레이를 생성합니다
          const customOverlay = new kakao.maps.CustomOverlay({
            position: overPosition,
            //            content: `<div class="mapLoc">${mapLoc[i].name}</div>`,
            //content: `<a class="mapLoc">${mapLoc[i].name}<img src="https://openweathermap.org/img/wn/${mapLoc[i].icon}.png"></a>`,
            content: `<a class="mapLoc"><img src="https://openweathermap.org/img/wn/${mapLoc[i].icon}.png"></a>`,
            xAnchor: -0.3,
            yAnchor: 1.5,
          });

          // 커스텀 오버레이를 지도에 표시합니다
          customOverlay.setMap(map);
        }

        //marker.setMap(map);
      }

      async function getWeather(lat, lon, i) {
        const W_API_KEY = "cdd8836d762fa089c19a028eff6b2067";
        try {
          const { data } = await axios.get("https://api.openweathermap.org/data/2.5/weather", {
            params: {
              lat: lat,
              lon: lon,
              appid: W_API_KEY,
              units: "metric",
              lang: "kr",
            },
          });
          icon = data.weather[0].icon;
          console.log(data.weather[0].main);
          console.log(i + "th : " + mapLoc[i].icon + "===> " + icon);
          mapLoc[i].icon = String(icon);

          //return icon;
        } catch (error) {}
      }
      // 카카오본사
      // locView(33.450701, 126.570667);
      // 서울시청
      locView(37.5665, 126.978);
      // 부산
      //locView(35.1796, 129.0756);
    </script>
  </body>
</html>
